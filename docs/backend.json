{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user profile.",
      "properties": {
        "uid": { "type": "string" },
        "anonymousName": { "type": "string" }
      },
      "required": ["uid", "anonymousName"]
    },
    "ChatMessage": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatMessage",
      "type": "object",
      "description": "Represents a single encrypted message within a user's inbox.",
      "properties": {
        "senderId": {
          "type": "string",
          "description": "The UID of the user who sent the message."
        },
        "senderName": {
            "type": "string",
            "description": "The anonymous name of the sender."
        },
        "encryptedPayload": {
          "type": "string",
          "description": "The end-to-end encrypted JSON string containing the message text and file data."
        },
        "timestamp": {
          "type": "object",
          "description": "Firestore server-side timestamp."
        },
        "anonymized": {
            "type": "boolean",
            "description": "Indicates if the original message content was altered by the AI."
        },
        "expireAt": {
            "type": "string",
            "format": "date-time",
            "description": "Timestamp for Firestore's TTL policy to auto-delete the message."
        }
      },
      "required": ["senderId", "senderName", "encryptedPayload", "timestamp", "expireAt"]
    },
    "ChatRoom": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "ChatRoom",
      "type": "object",
      "description": "Represents a chat room where users can exchange messages.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Name of the chat room."
        },
        "createdAt": {
          "type": "object",
          "description": "Firestore server-side timestamp."
        },
        "region": {
          "type": "string",
          "description": "Geographic region of the room."
        },
        "isPublic": {
            "type": "boolean",
            "description": "Indicates if the room is a public lobby or a private room."
        },
        "participants": {
            "type": "object",
            "description": "A map of participant UIDs to their public keys and anonymous names for E2EE."
        }
      },
      "required": ["name", "createdAt", "region", "isPublic"]
    }
  },
  "auth": {
    "providers": ["anonymous"]
  },
  "firestore": {
      "/users/{userId}": {
        "schema": { "$ref": "#/entities/User" },
        "description": "Stores user profile information, like their anonymous name."
      },
      "/users/{userId}/inbox/{messageId}": {
        "schema": { "$ref": "#/entities/ChatMessage" },
        "description": "Stores encrypted messages delivered to a specific user.",
        "ttl": {
          "field": "expireAt"
        }
      },
      "/chatRooms/{chatRoomId}": {
        "schema": { "$ref": "#/entities/ChatRoom" },
        "description": "Stores chat room metadata, including participants and their public keys."
      }
  }
}
